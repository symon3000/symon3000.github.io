<!DOCTYPE html>
<html>

<head>
  <title>Just write.</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400&display=swap" rel="stylesheet">
</head>

<body>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #111;
      color: #eee;
      font-family: 'Quicksand', sans-serif;
      line-height: 2;
      overflow: hidden;
      height: 100vh;
    }

    #app-container {
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 20px;
      padding: 20px 0;
    }

    #panes-wrapper {
      flex: 0 0 auto;
      width: 100%;
      overflow: hidden;
      position: relative;
    }

    #panes-container {
      display: flex;
      transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .pane {
      min-width: 100vw;
      width: 100vw;
      flex-shrink: 0;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .editor {
      background-color: #222;
      color: #ffe;
      padding: 10px;
      border-radius: 5px;
      max-width: 800px;
      width: 90%;
      height: 70vh;
      font-size: 15px;
      outline: none;
      overflow: hidden;
      resize: none;
      border: none;
      font-family: 'Quicksand', sans-serif;
      line-height: 2;
    }

    #pagination {
      flex: 0 0 auto;
      display: none;
      gap: 8px;
      align-items: center;
      justify-content: center;
    }

    #pagination.visible {
      display: flex;
    }

    .page-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: rgba(255, 255, 238, 0.3);
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .page-dot:hover {
      background-color: rgba(255, 255, 238, 0.6);
    }

    .page-dot.active {
      background-color: rgba(255, 255, 238, 1);
    }

    #save-button {
      flex: 0 0 auto;
      background-color: rgba(68, 68, 68, 0.1);
      color: rgba(255, 255, 238, 0.3);
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-family: 'Quicksand', sans-serif;
      transition: all 0.3s ease;
    }

    #save-button:hover {
      background-color: rgba(68, 68, 68, 0.8);
      color: rgba(255, 255, 238, 1);
    }
  </style>

  <div id="app-container">
    <div id="panes-wrapper">
      <div id="panes-container">
        <div class="pane">
          <div class="editor" contenteditable="true"></div>
        </div>
      </div>
    </div>
    
    <div id="pagination"></div>
    <button id="save-button">Save</button>
  </div>

  <script>
    const panesContainer = document.getElementById('panes-container');
    const pagination = document.getElementById('pagination');
    let currentPane = 0;
    let panes = [];
    let isNavigating = false;

    // Initialize first pane
    function init() {
      const firstEditor = document.querySelector('.editor');
      panes.push(firstEditor);
      firstEditor.focus();
      updatePagination();
      
      // Monitor content and create new pane when needed
      firstEditor.addEventListener('input', () => checkAndCreateNewPane(firstEditor, 0));
      firstEditor.addEventListener('keydown', handleEditorKeydown);
    }

    function updatePagination() {
      pagination.innerHTML = '';
      
      if (panes.length > 1) {
        pagination.classList.add('visible');
        panes.forEach((_, index) => {
          const dot = document.createElement('div');
          dot.className = 'page-dot';
          if (index === currentPane) {
            dot.classList.add('active');
          }
          dot.addEventListener('click', () => navigateToPane(index));
          pagination.appendChild(dot);
        });
      } else {
        pagination.classList.remove('visible');
      }
    }

    function checkAndCreateNewPane(editor, paneIndex) {
      // Check if we're at the bottom and need a new pane
      if (paneIndex === panes.length - 1) {
        const lineHeight = parseFloat(getComputedStyle(editor).lineHeight);
        const editorHeight = editor.clientHeight;
        const scrollHeight = editor.scrollHeight;
        
        // If content exceeds visible area, create new pane
        if (scrollHeight > editorHeight + lineHeight) {
          createNewPane();
        }
      }
    }

    function createNewPane() {
      const newPaneDiv = document.createElement('div');
      newPaneDiv.className = 'pane';
      
      const newEditor = document.createElement('div');
      newEditor.className = 'editor';
      newEditor.contentEditable = 'true';
      
      newPaneDiv.appendChild(newEditor);
      panesContainer.appendChild(newPaneDiv);
      
      panes.push(newEditor);
      
      // Add event listeners to new editor
      newEditor.addEventListener('input', () => checkAndCreateNewPane(newEditor, panes.length - 1));
      newEditor.addEventListener('keydown', handleEditorKeydown);
      
      // Update pagination
      updatePagination();
      
      // Navigate to new pane
      navigateToPane(panes.length - 1);
      
      // Focus on new editor
      setTimeout(() => {
        newEditor.focus();
      }, 650);
    }

    function navigateToPane(index) {
      if (index < 0 || index >= panes.length || isNavigating) return;
      
      isNavigating = true;
      currentPane = index;
      const offset = -index * window.innerWidth;
      panesContainer.style.transform = `translateX(${offset}px)`;
      
      // Update pagination
      updatePagination();
      
      setTimeout(() => {
        isNavigating = false;
        panes[currentPane].focus();
      }, 600);
    }

    function handleEditorKeydown(e) {
      // Prevent default behavior for navigation
      if (e.key === 'ArrowUp' || e.key === 'ArrowDown') {
        const editor = e.target;
        const selection = window.getSelection();
        const range = selection.getRangeAt(0);
        const rect = range.getBoundingClientRect();
        const editorRect = editor.getBoundingClientRect();
        
        // Check if at top or bottom of editor
        if (e.key === 'ArrowUp' && rect.top <= editorRect.top + 5) {
          e.preventDefault();
        } else if (e.key === 'ArrowDown' && rect.bottom >= editorRect.bottom - 5) {
          e.preventDefault();
        }
      }
    }

    // Wheel navigation
    let wheelTimeout;
    let wheelDelta = 0;
    const wheelThreshold = 100;

    window.addEventListener('wheel', (e) => {
      if (isNavigating) return;
      
      wheelDelta += e.deltaY;
      
      clearTimeout(wheelTimeout);
      wheelTimeout = setTimeout(() => {
        if (Math.abs(wheelDelta) > wheelThreshold) {
          if (wheelDelta > 0 && currentPane < panes.length - 1) {
            navigateToPane(currentPane + 1);
          } else if (wheelDelta < 0 && currentPane > 0) {
            navigateToPane(currentPane - 1);
          }
        }
        wheelDelta = 0;
      }, 50);
    }, { passive: true });

    // Save functionality
    const saveButton = document.getElementById('save-button');

    function saveContent() {
      const content = panes.map(editor => editor.innerText).join('');
      const blob = new Blob([content], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      
      const now = new Date();
      const filename = [
        [
          now.getMonth() + 1,
          now.getDate(),
          now.getFullYear().toString().slice(-2)
        ].join('.'),
        [
          now.getHours() % 12 || 12,
          now.getMinutes().toString().padStart(2, '0'),
          now.getHours() >= 12 ? 'PM' : 'AM'
        ].join('.')
      ].join(' | ') + '.txt';
      
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    saveButton.addEventListener('click', saveContent);

    document.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
        e.preventDefault();
        saveContent();
      }
    });

    // Initialize on load
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>
