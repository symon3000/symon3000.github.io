<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draggable To-Do Cards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        #canvas {
            width: 100%;
            height: 80vh;
            background-color: #fff;
            border: 1px solid #ccc;
            position: relative;
            overflow: auto;
        }
        .card {
            width: 200px;
            min-height: 100px;
            background-color: #ffeb3b;
            border: 1px solid #fdd835;
            border-radius: 5px;
            padding: 10px;
            position: absolute;
            cursor: move;
            user-select: none;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            cursor: pointer;
            font-weight: bold;
            color: #ff4444;
        }
        #add-card {
            position: fixed;
            top: 20px;
            right: 20px;
            font-size: 36px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        #add-card:hover {
            background-color: #45a049;
        }
        .card.selected {
            box-shadow: 0 0 0 2px #4CAF50;
        }
        #selection-box {
            position: absolute;
            border: 2px dashed #4CAF50;
            background-color: rgba(76, 175, 80, 0.1);
            pointer-events: none;
        }
    </style>
</head>
<body>
    <h1>Draggable To-Do Cards</h1>
    <div id="canvas"></div>
    <button id="add-card">+</button>

    <script>
        const todos = [
            "Double-click to edit."
        ];

        const canvas = document.getElementById('canvas');
        const addCardBtn = document.getElementById('add-card');
        let activeCard = null;
        let initialX, initialY;
        let isEditing = false;
        let isSelecting = false;
        let selectionStart = { x: 0, y: 0 };
        let selectionBox = null;
        let selectedCards = new Set();

        function createCard(text = '', x = 0, y = 0) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <span class="delete-btn">&times;</span>
                <p class="card-text">${text}</p>
            `;
            card.style.left = `${x}px`;
            card.style.top = `${y}px`;
            
            const deleteBtn = card.querySelector('.delete-btn');
            deleteBtn.addEventListener('click', () => {
                canvas.removeChild(card);
            });
            
            const cardText = card.querySelector('.card-text');
            cardText.addEventListener('dblclick', () => {
                isEditing = true;
                cardText.contentEditable = true;
                cardText.focus();
            });
            
            cardText.addEventListener('blur', () => {
                isEditing = false;
                cardText.contentEditable = false;
            });
            
            card.addEventListener('mousedown', startDragging);
            canvas.appendChild(card);

            // Focus on the text and make it editable immediately for new cards
            if (text === 'New Todo') {
                isEditing = true;
                cardText.contentEditable = true;
                cardText.focus();
                // Select all text
                window.getSelection().selectAllChildren(cardText);
            }
        }

        todos.forEach((todo, index) => {
            createCard(todo, (index % 5) * 220, Math.floor(index / 5) * 120);
        });

        addCardBtn.addEventListener('click', () => {
            const x = Math.random() * (canvas.clientWidth - 200);
            const y = Math.random() * (canvas.clientHeight - 100);
            createCard('New Todo', x, y);
        });

        canvas.addEventListener('mousedown', startSelection);
        canvas.addEventListener('mousemove', updateSelection);
        canvas.addEventListener('mouseup', endSelection);

        function startSelection(e) {
            if (e.target === canvas) {
                isSelecting = true;
                selectionStart = { x: e.clientX + canvas.scrollLeft, y: e.clientY + canvas.scrollTop };
                selectionBox = document.createElement('div');
                selectionBox.id = 'selection-box';
                canvas.appendChild(selectionBox);
            }
        }

        function updateSelection(e) {
            if (isSelecting) {
                const currentX = e.clientX + canvas.scrollLeft;
                const currentY = e.clientY + canvas.scrollTop;
                const left = Math.min(selectionStart.x, currentX);
                const top = Math.min(selectionStart.y, currentY);
                const width = Math.abs(currentX - selectionStart.x);
                const height = Math.abs(currentY - selectionStart.y);

                selectionBox.style.left = `${left}px`;
                selectionBox.style.top = `${top}px`;
                selectionBox.style.width = `${width}px`;
                selectionBox.style.height = `${height}px`;

                // Check which cards are within the selection box
                document.querySelectorAll('.card').forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const cardLeft = rect.left + canvas.scrollLeft;
                    const cardTop = rect.top + canvas.scrollTop;
                    if (cardLeft < left + width && cardLeft + rect.width > left &&
                        cardTop < top + height && cardTop + rect.height > top) {
                        card.classList.add('selected');
                        selectedCards.add(card);
                    } else {
                        card.classList.remove('selected');
                        selectedCards.delete(card);
                    }
                });
            }
        }

        function endSelection() {
            isSelecting = false;
            if (selectionBox) {
                canvas.removeChild(selectionBox);
                selectionBox = null;
            }
        }

        function startDragging(e) {
            if (isEditing) return;
            activeCard = e.currentTarget;
            initialX = e.clientX - activeCard.offsetLeft;
            initialY = e.clientY - activeCard.offsetTop;

            if (!activeCard.classList.contains('selected')) {
                selectedCards.forEach(card => card.classList.remove('selected'));
                selectedCards.clear();
                activeCard.classList.add('selected');
                selectedCards.add(activeCard);
            }

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDragging);
        }

        function drag(e) {
            if (activeCard) {
                e.preventDefault();
                let newX = e.clientX - initialX;
                let newY = e.clientY - initialY;
                
                newX += canvas.scrollLeft;
                newY += canvas.scrollTop;
                
                const deltaX = newX - parseInt(activeCard.style.left);
                const deltaY = newY - parseInt(activeCard.style.top);

                selectedCards.forEach(card => {
                    const cardX = parseInt(card.style.left) + deltaX;
                    const cardY = parseInt(card.style.top) + deltaY;
                    card.style.left = `${cardX}px`;
                    card.style.top = `${cardY}px`;
                });
            }
        }

        function stopDragging() {
            activeCard = null;
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDragging);
        }
    </script>
</body>
</html>
